<html>
	<head>
		<meta charset="utf-8">
		<title>Projeto ecs4</title>
		
		<script src="https://d3js.org/d3.v5.min.js"></script>
	</head>
	<body>
	
		<datalist id="tickmarks">
			<option value="0" />
			<option value="10" />
			<option value="20" />
			<option value="30" />
			<option value="40" />
			<option value="50" />
			<option value="60" />
			<option value="70" />
			<option value="80" />
			<option value="90" />
			<option value="100" />
			<option value="200" />
			<option value="300" />
			<option value="400" />
			<option value="500" />
			<option value="600" />
			<option value="700" />
			<option value="800" />
			<option value="900" />
			<option value="1000" />
		</datalist>

		<svg id="grafico" width="800" height="800" />

		</br>

		<script>
		// Variaveis globais para me ajudar
		let dataset = undefined;
		let width = 800;
		let height = 800;

		// Lendo Arquivo
		d3.csv("https://raw.githubusercontent.com/EduardoCintraSimoes/ProjetoVisualizacao/main/dataset.csv")
		//d3.csv("dataset.csv")
			.then(function(data){
				//processar dados
				dataset = data;
				//converter dados textuais para numericos
				dataset.forEach(function(element){
					//element.processorError = element.processorError;
					//element.qaDefault = element.qaDefault;
					element.qaDPI = +element.qaDPI;
					element.qaDensity = +element.qaDensity;
					element.qaInclination = +element.qaInclination;
					element.qaLightness = +element.qaLightness;
					element.qaShadow = +element.qaShadow;
					element.qaFocus = +element.qaFocus;
					element.qaShine = +element.qaShine;
					//element.classification = element.classification;
					element.classificationConf = +element.classificationConf;
					element.expeditionDateSim = +element.expeditionDateSim;
					element.expeditionDateConf = +element.expeditionDateConf;
					element.birthdateSim = +element.birthdateSim;
					element.birthdateConf = +element.birthdateConf;
					element.filiationASim = +element.filiationASim;
					element.filiationAConf = +element.filiationAConf;
					element.filiationBSim = +element.filiationBSim;
					element.filiationBConf = +element.filiationBConf;
					element.birthplaceSim = +element.birthplaceSim;
					element.birthplaceConf = +element.birthplaceConf;
					element.nameSim = +element.nameSim;
					element.nameConf = +element.nameConf;
					element.cpfSim = +element.cpfSim;
					element.cpfConf = +element.cpfConf;
					element.rgSim = +element.rgSim;
					element.rgConf = +element.rgConf;
				});
				setInterface();
			});

		//Seta os eventos
		function setInterface(){
		
			var newGroup = d3.select("body").append("table").attr("border",1);//.append("g");
		
			// controles de qualidade
			var rowGroup = newGroup.append("tr");
			setSlider(rowGroup.append("th"), "qaDpi", "DPI", 100, 1000, 200);
			setSlider(rowGroup.append("th"), "qaDensity", "Densidade", 0, 50, 5, 0.1);
			setSlider(rowGroup.append("th"), "qaInclination", "Inclinação", 0, 40, 2, 0.1);
			setSlider(rowGroup.append("th"), "qaLightness", "Iluminação", 0, 100, 60);
			setSlider(rowGroup.append("th"), "qaShadow", "Sombra", 0, 100, 60);
			setSlider(rowGroup.append("th"), "qaFocus", "Foco", 0, 100, 60);
			setSlider(rowGroup.append("th"), "qaShine", "Brilho", 0, 100, 60);
			
			// controles de classificação
			setSlider(rowGroup.append("th"), "classifConf", "Classificação", 0, 100, 70);
			
			// controles de extração
			var rowGroup = newGroup.append("tr");
			setExtractionSlider(rowGroup.append("th"), "expeditionDateConf", "Data de Expedição");
			setExtractionSlider(rowGroup.append("th"), "birthdateConf", "Data de Nascimento");
			setExtractionSlider(rowGroup.append("th"), "filiationAConf", "Filiação A");
			setExtractionSlider(rowGroup.append("th"), "filiationBConf", "Filiação B");
			setExtractionSlider(rowGroup.append("th"), "birthplaceConf", "Naturalidade");
			setExtractionSlider(rowGroup.append("th"), "nameConf", "Nome");
			setExtractionSlider(rowGroup.append("th"), "cpfConf", "CPF");
			setExtractionSlider(rowGroup.append("th"), "rgConf", "RG");
			
			//	
			let svg = d3.select("svg");
			svg.append("g").attr("id","groupEixoX").attr("transform","translate(0,780)");
			svg.append("g").attr("id","groupEixoY").attr("transform","translate(50,0)");
			svg.append("g").attr("id","groupCircles");
			svg.append("text").attr("id","tooltip");
			drawData();
		}

		function setExtractionSlider(newGroup, name, text) {
			newGroup.text(text); // título
			newGroup.append("br");
			setSlider( newGroup, name + "Conf", "Confiança", 0, 100, 70); // confiança
			newGroup.append("br");
			setSlider( newGroup, name + "Sim", "Similaridade", 0, 100, 90); // similaridade
		}

		function setSlider(newGroup, name, text, minVal, maxVal, defaultVal, step = 1) {
			var sliderTag = name + "Slider";
			var labelTag = name + "Label";
			
			// texto
			newGroup.append("label").text(text + ": ");
			newGroup.append("label").attr("id", labelTag).text(defaultVal);
			newGroup.append("br");
			
			// barra
			newGroup.append("input").attr("id", sliderTag).attr("type", "range").attr("step",step)
				.attr("min", minVal).attr("max", maxVal).attr("value", defaultVal).attr("list","tickmarks");
			
			//evento de mudança do valor do slider
			d3.select("#" + sliderTag).on("change",function(){
				let aux = getSlider(name);
				d3.select("#" + labelTag).text(aux);
				drawData();
			});
		}
		
		// retorna o valor da barra
		function getSlider(name) {
			return +d3.select("#" + name + "Slider").node().value;
		}
		
		//Desenha gráfico
		function drawData(){
				
		}
		</script>

	</body>
</html>